<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>automl • automl</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="automl">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">automl</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/automl.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/aboulaboul/automl">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>automl</h1>
                        <h4 class="author">Alex Boulangé</h4>
            
            <h4 class="date">january 09, 2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/aboulaboul/automl/blob/master/vignettes/automl.Rmd"><code>vignettes/automl.Rmd</code></a></small>
      <div class="hidden name"><code>automl.Rmd</code></div>

    </div>

    
    

<h2 id="contents" class="likechapterHead">
<span id="x1-1000"></span>Contents
</h2>
<div class="tableofcontents">
<p> <span class="sectionToc">0.1 <a href="#x1-20000.1" id="QQ2-1-2">Introduction to automl package</a></span><br>  <span class="sectionToc">0.2 <a href="#x1-30000.2" id="QQ2-1-3">Why &amp; how automl</a></span><br>   <span class="subsectionToc">0.2.1 <a href="#x1-40000.2.1" id="QQ2-1-4">Deep Learning existing frameworks, disadvantages</a></span><br>   <span class="subsectionToc">0.2.2 <a href="#x1-50000.2.2" id="QQ2-1-5">Neural Network - Deep Learning, disadvantages</a></span><br>   <span class="subsectionToc">0.2.3 <a href="#x1-60000.2.3" id="QQ2-1-6">Metaheuristic - PSO, benefits</a></span><br>   <span class="subsectionToc">0.2.4 <a href="#x1-70000.2.4" id="QQ2-1-7">Birth of automl package</a></span><br>   <span class="subsectionToc">0.2.5 <a href="#x1-80000.2.5" id="QQ2-1-8">Mix 1: hyperparameters tuning with PSO</a></span><br>   <span class="subsectionToc">0.2.6 <a href="#x1-90000.2.6" id="QQ2-1-9">Mix 2: PSO instead of gradient descent</a></span><br>  <span class="sectionToc">0.3 <a href="#x1-100000.3" id="QQ2-1-10">First steps: How to</a></span><br>   <span class="subsectionToc">0.3.1 <a href="#x1-110000.3.1" id="QQ2-1-11">fit a regression model manually (hard way)</a></span><br>   <span class="subsectionToc">0.3.2 <a href="#x1-120000.3.2" id="QQ2-1-12">fit a regression model automatically (easy way, Mix 1)</a></span><br>   <span class="subsectionToc">0.3.3 <a href="#x1-130000.3.3" id="QQ2-1-13">fit a regression model experimentally (experimental way, Mix 2)</a></span><br>   <span class="subsectionToc">0.3.4 <a href="#x1-140000.3.4" id="QQ2-1-14">fit a regression model with custom cost (experimental way, Mix 2)</a></span><br>   <span class="subsectionToc">0.3.5 <a href="#x1-150000.3.5" id="QQ2-1-15">fit a classification model with softmax (Mix 2)</a></span><br>   <span class="subsectionToc">0.3.6 <a href="#x1-160000.3.6" id="QQ2-1-16">change the model parameters (shape …)</a></span><br>   <span class="subsectionToc">0.3.7 <a href="#x1-170000.3.7" id="QQ2-1-17">continue training on saved model (fine tuning …)</a></span><br>   <span class="subsectionToc">0.3.8 <a href="#x1-180000.3.8" id="QQ2-1-18">use the 2 steps automatic approach</a></span><br>  <span class="sectionToc">0.4 <a href="#x1-190000.4" id="QQ2-1-19">ToDo List</a></span></p>
</div>
<h3 id="introduction-to-automl-package" class="sectionHead">
<span class="titlemark">0.1 </span> <span id="x1-20000.1"></span>Introduction to automl package
</h3>
<p>
This document is intended to answer the following questions; why &amp; how automl and how to use it<br><br> automl package provides:<br> -Deep Learning last tricks (those who have taken Andrew NG’s MOOC on Coursera will be in familiar territory)<br> -hyperparameters autotune with metaheuristic (PSO)<br> -experimental stuff and more to come (you’re welcome as coauthor!)<br></p>
<h3 id="why-how-automl" class="sectionHead">
<span class="titlemark">0.2 </span> <span id="x1-30000.2"></span>Why &amp; how automl
</h3>
<h4 id="deep-learning-existing-frameworks-disadvantages" class="subsectionHead">
<span class="titlemark">0.2.1 </span> <span id="x1-40000.2.1"></span>Deep Learning existing frameworks, disadvantages
</h4>
<p>
Deploying and maintaining most Deep Learning frameworks means: Python…<br> R language is so simple to install and maintain in production environments that it is obvious to use a pure R based package for deep learning !<br></p>
<h4 id="neural-network---deep-learning-disadvantages" class="subsectionHead">
<span class="titlemark">0.2.2 </span> <span id="x1-50000.2.2"></span>Neural Network - Deep Learning, disadvantages
</h4>
<p>
Disadvantages :<br> 1st disadvantage: you have to test manually different combinations of parameters (number of layers, nodes, activation function, etc …) and then also tune manually hyper parameters for training (learning rate, momentum, mini batch size, etc …)<br> 2nd disadvantage: only for those who are not mathematicians, calculating derivative in case of new cost or activation function, may by an issue.<br><br><img src="imgperc001.png" alt="PIC"><br></p>
<h4 id="metaheuristic---pso-benefits" class="subsectionHead">
<span class="titlemark">0.2.3 </span> <span id="x1-60000.2.3"></span>Metaheuristic - PSO, benefits
</h4>
<p>
The Particle Swarm Optimization algorithm is a great and simple one.<br> In a few words, the first step consists in throwing randomly a set of particles in a space and the next steps consist in discovering the best solution while converging.<br><img src="imgperc002.png" alt="PIC"><br> video tutorial from Yarpiz is a great ressource<br></p>
<h4 id="birth-of-automl-package" class="subsectionHead">
<span class="titlemark">0.2.4 </span> <span id="x1-70000.2.4"></span>Birth of automl package
</h4>
<p>
automl package was born from the idea to use metaheuristic PSO to address the identified disadvantages above.<br> And last but not the least reason: use R and R only :-)<br> 3 functions are available:<br> - automl_train_manual: the manual mode to train a model<br> - automl_train: the automatic mode to train model<br> - automl_predict: the prediction function to apply a trained model on datas<br></p>
<h4 id="mix-1-hyperparameters-tuning-with-pso" class="subsectionHead">
<span class="titlemark">0.2.5 </span> <span id="x1-80000.2.5"></span>Mix 1: hyperparameters tuning with PSO
</h4>
<p>
Mix 1 consists in using PSO algorithm to optimize the hyperparameters: each particle corresponds to a set of hyperparameters.<br> The automl_train function was made to do that.<br><br><img src="imgperc003.png" alt="PIC"><br></p>
<h4 id="mix-2-pso-instead-of-gradient-descent" class="subsectionHead">
<span class="titlemark">0.2.6 </span> <span id="x1-90000.2.6"></span>Mix 2: PSO instead of gradient descent
</h4>
<p>
Mix 2 is experimental, it consists in using PSO algorithm to optimize the weights of Neural Network in place of gradient descent: each particle corresponds to a set of neural network weights matrices.<br> The automl_train_manual function do that too.<br><br><img src="imgperc004.png" alt="PIC"><br></p>
<h3 id="first-steps-how-to" class="sectionHead">
<span class="titlemark">0.3 </span> <span id="x1-100000.3"></span>First steps: How to
</h3>
<p>
For those who will laugh at seeing deep learning with one hidden layer and the Iris data set of 150 records, I will say: you’re perfectly right :-)<br> The goal at this stage is simply to take the first steps
</p>
<h4 id="fit-a-regression-model-manually-hard-way" class="subsectionHead">
<span class="titlemark">0.3.1 </span> <span id="x1-110000.3.1"></span>fit a regression model manually (hard way)
</h4>
<p>
Subject: predict Sepal.Length given other Iris parameters<br> 1st with gradient descent and default hyperparameters value for learning rate (0.001) and mini batch size (32)<br></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(iris)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">xmat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(iris[,<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>], <span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(iris<span class="op">$</span>Species))</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">ymat &lt;-<span class="st"> </span>iris[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train_manual.html">automl_train_manual</a></span>(<span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat)</a></code></pre></div>
<pre><code>## (cost: mse)
## cost epoch10: 4.32448145592516 (cv cost: 7.44514208138857) (LR:  0.001 ) 
## cost epoch20: 1.27972351311775 (cv cost: 1.69428813572827) (LR:  0.001 ) 
## cost epoch30: 0.991239258252379 (cv cost: 1.35479595235304) (LR:  0.001 ) 
## cost epoch40: 0.874354643996513 (cv cost: 1.11254348557089) (LR:  0.001 ) 
## cost epoch50: 0.820912599503419 (cv cost: 0.94611998908678) (LR:  0.001 ) 
##    dim X: [4,135]
##    dim W1: [10,4] (min|max: -1.54429770594677, 1.76233243009315)
##    dim bB1: [10,1] (min|max: 0, 0.535820185335336)
##    dim W2: [1,10] (min|max: -0.0130920429820853, 0.359182043843503)
##    dim bB2: [1,1] (min|max: 0.0738492547345204, 0.0738492547345204)
##    dim Y: [1,135]</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">res &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(ymat, <span class="kw"><a href="../reference/automl_predict.html">automl_predict</a></span>(<span class="dt">model =</span> amlmodel, <span class="dt">X =</span> xmat))</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(res) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'actual'</span>, <span class="st">'predict'</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(res)</a></code></pre></div>
<pre><code>##      actual  predict
## [1,]    5.1 3.110401
## [2,]    4.9 2.958797
## [3,]    4.7 2.980532
## [4,]    4.6 3.028025
## [5,]    5.0 3.140722
## [6,]    5.4 3.451010</code></pre>
<p>:-[] no pain, no gain …<br> After some manual fine tuning on learning rate, mini batch size and iterations number (epochs):<br></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(iris)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">xmat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(iris[,<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>], <span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(iris<span class="op">$</span>Species))</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">ymat &lt;-<span class="st"> </span>iris[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train_manual.html">automl_train_manual</a></span>(<span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat,</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">                                <span class="dt">hpar =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">learningrate =</span> <span class="fl">0.01</span>,</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">                                <span class="dt">minibatchsize =</span> <span class="dv">2</span><span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">                                <span class="dt">numiterations =</span> <span class="dv">30</span>))</a></code></pre></div>
<pre><code>## (cost: mse)
## cost epoch10: 0.0909389048336394 (cv cost: 0.439632172549961) (LR:  0.01 ) 
## cost epoch20: 0.210309280392956 (cv cost: 0.269961600588818) (LR:  0.01 ) 
## cost epoch30: 0.184726596625289 (cv cost: 0.23328493701916) (LR:  0.01 ) 
##    dim X: [4,135]
##    dim W1: [10,4] (min|max: -1.54429770594677, 2.74230332717209)
##    dim bB1: [10,1] (min|max: -0.317658298585351, 1.90363761544538)
##    dim W2: [1,10] (min|max: -0.313978049365135, 0.272467258806951)
##    dim bB2: [1,1] (min|max: 0.315091282545438, 0.315091282545438)
##    dim Y: [1,135]</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">res &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(ymat, <span class="kw"><a href="../reference/automl_predict.html">automl_predict</a></span>(<span class="dt">model =</span> amlmodel, <span class="dt">X =</span> xmat))</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(res) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'actual'</span>, <span class="st">'predict'</span>)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(res)</a></code></pre></div>
<pre><code>##      actual  predict
## [1,]    5.1 5.516877
## [2,]    4.9 4.978799
## [3,]    4.7 5.182687
## [4,]    4.6 5.097757
## [5,]    5.0 5.624492
## [6,]    5.4 5.998602</code></pre>
<p>Better result, but with human efforts!<br></p>
<h4 id="fit-a-regression-model-manually-hard-way" class="subsectionHead">
<span class="titlemark">0.3.2 </span> <span id="x1-120000.3.2"></span>fit a regression model automatically (easy way, Mix 1)
</h4>
<p>Same subject: predict Sepal.Length given other Iris parameters<br></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(iris)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">xmat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(iris[,<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>], <span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(iris<span class="op">$</span>Species)))</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">ymat &lt;-<span class="st"> </span>iris[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">start.time &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span>()</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train.html">automl_train</a></span>(<span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat,</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">                         <span class="dt">autopar =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">psopartpopsize =</span> <span class="dv">15</span>,</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">                                        <span class="dt">numiterations =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">                                        <span class="dt">auto_layers_max =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">                                        <span class="dt">nbcores =</span> <span class="dv">4</span>))</a></code></pre></div>
<pre><code>## (cost: mse)
## iteration 1 particle 1 weighted err: 18.02186 (train: 17.4759 cvalid: 16.111 ) BEST MODEL KEPT
## iteration 1 particle 2 weighted err: 17.39575 (train: 16.86192 cvalid: 15.52734 ) BEST MODEL KEPT
## iteration 1 particle 3 weighted err: 18.58025 (train: 17.96074 cvalid: 16.41196 )
## iteration 1 particle 4 weighted err: 20.59253 (train: 19.78752 cvalid: 17.77499 )
## iteration 1 particle 5 weighted err: 17.09589 (train: 16.61277 cvalid: 15.40496 ) BEST MODEL KEPT
## iteration 1 particle 6 weighted err: 19.76509 (train: 19.02818 cvalid: 17.18591 )
## iteration 1 particle 7 weighted err: 14.49483 (train: 14.28691 cvalid: 13.76709 ) BEST MODEL KEPT
## iteration 1 particle 8 weighted err: 10.10214 (train: 8.99941 cvalid: 9.68862 ) BEST MODEL KEPT
## iteration 1 particle 9 weighted err: 14.29499 (train: 14.14298 cvalid: 13.76297 )
## iteration 1 particle 10 weighted err: 0.59976 (train: 0.56871 cvalid: 0.49107 ) BEST MODEL KEPT
## iteration 1 particle 11 weighted err: 6.85908 (train: 3.94742 cvalid: 5.76721 )
## iteration 1 particle 12 weighted err: 20.50769 (train: 19.71033 cvalid: 17.71692 )
## iteration 1 particle 13 weighted err: 0.73017 (train: 0.51338 cvalid: 0.64888 )
## iteration 1 particle 14 weighted err: 18.6274 (train: 18.00644 cvalid: 16.45405 )
## iteration 1 particle 15 weighted err: 18.1267 (train: 17.55215 cvalid: 16.11577 )
## iteration 2 particle 1 weighted err: 3.57996 (train: 0.62222 cvalid: 2.47081 )
## iteration 2 particle 2 weighted err: 7.25992 (train: 5.1728 cvalid: 6.47725 )
## iteration 2 particle 3 weighted err: 1.75391 (train: 0.04264 cvalid: 1.11218 )
## iteration 2 particle 4 weighted err: 8.22296 (train: 5.20481 cvalid: 7.09116 )
## iteration 2 particle 5 weighted err: 0.39498 (train: 0.3159 cvalid: 0.1182 ) BEST MODEL KEPT
## iteration 2 particle 6 weighted err: 12.99226 (train: 12.87704 cvalid: 12.58897 )
## iteration 2 particle 7 weighted err: 0.69904 (train: 0.51322 cvalid: 0.62936 )
## iteration 2 particle 8 weighted err: 10.10214 (train: 8.99941 cvalid: 9.68862 )
## iteration 2 particle 9 weighted err: 0.2747 (train: 0.2225 cvalid: 0.09202 ) BEST MODEL KEPT
## iteration 2 particle 10 weighted err: 0.543 (train: 0.52841 cvalid: 0.53753 )
## iteration 2 particle 11 weighted err: 0.21454 (train: 0.18248 cvalid: 0.10232 ) BEST MODEL KEPT
## iteration 2 particle 12 weighted err: 10.3364 (train: 7.83458 cvalid: 9.39822 )
## iteration 2 particle 13 weighted err: 0.73017 (train: 0.51338 cvalid: 0.64888 )
## iteration 2 particle 14 weighted err: 12.53886 (train: 12.53397 cvalid: 12.52175 )
## iteration 2 particle 15 weighted err: 0.67686 (train: 0.48915 cvalid: 0.60647 )
## iteration 3 particle 1 weighted err: 0.16893 (train: 0.14979 cvalid: 0.10194 ) BEST MODEL KEPT
## iteration 3 particle 2 weighted err: 0.25774 (train: 0.20635 cvalid: 0.07786 )
## iteration 3 particle 3 weighted err: 0.20948 (train: 0.17599 cvalid: 0.09225 )
## iteration 3 particle 4 weighted err: 0.28547 (train: 0.2331 cvalid: 0.10217 )
## iteration 3 particle 5 weighted err: 0.29453 (train: 0.23342 cvalid: 0.08064 )
## iteration 3 particle 6 weighted err: 5.69445 (train: 2.46895 cvalid: 4.48489 )
## iteration 3 particle 7 weighted err: 0.31008 (train: 0.24159 cvalid: 0.07036 )
## iteration 3 particle 8 weighted err: 0.40518 (train: 0.32648 cvalid: 0.12973 )
## iteration 3 particle 9 weighted err: 0.26302 (train: 0.20913 cvalid: 0.0744 )
## iteration 3 particle 10 weighted err: 0.543 (train: 0.52841 cvalid: 0.53753 )
## iteration 3 particle 11 weighted err: 0.21454 (train: 0.18248 cvalid: 0.10232 )
## iteration 3 particle 12 weighted err: 0.48475 (train: 0.43012 cvalid: 0.29354 )
## iteration 3 particle 13 weighted err: 0.17314 (train: 0.15263 cvalid: 0.10136 )
## iteration 3 particle 14 weighted err: 3.08393 (train: 0.41376 cvalid: 2.08262 )
## iteration 3 particle 15 weighted err: 0.13461 (train: 0.12747 cvalid: 0.10963 ) BEST MODEL KEPT
## iteration 4 particle 1 weighted err: 0.16893 (train: 0.14979 cvalid: 0.10194 )
## iteration 4 particle 2 weighted err: 0.25774 (train: 0.20635 cvalid: 0.07786 )
## iteration 4 particle 3 weighted err: 0.20948 (train: 0.17599 cvalid: 0.09225 )
## iteration 4 particle 4 weighted err: 0.1644 (train: 0.14916 cvalid: 0.11106 )
## iteration 4 particle 5 weighted err: 0.19234 (train: 0.16307 cvalid: 0.08991 )
## iteration 4 particle 6 weighted err: 0.34724 (train: 0.28248 cvalid: 0.12058 )
## iteration 4 particle 7 weighted err: 0.26448 (train: 0.21072 cvalid: 0.0763 )
## iteration 4 particle 8 weighted err: 0.16131 (train: 0.14443 cvalid: 0.10223 )
## iteration 4 particle 9 weighted err: 0.26302 (train: 0.20913 cvalid: 0.0744 )
## iteration 4 particle 10 weighted err: 0.543 (train: 0.52841 cvalid: 0.53753 )
## iteration 4 particle 11 weighted err: 0.12011 (train: 0.11639 cvalid: 0.10708 ) BEST MODEL KEPT
## iteration 4 particle 12 weighted err: 0.3232 (train: 0.26459 cvalid: 0.11805 )
## iteration 4 particle 13 weighted err: 0.17314 (train: 0.15263 cvalid: 0.10136 )
## iteration 4 particle 14 weighted err: 0.29992 (train: 0.24038 cvalid: 0.09152 )
## iteration 4 particle 15 weighted err: 0.13461 (train: 0.12747 cvalid: 0.10963 )
## iteration 5 particle 1 weighted err: 0.15678 (train: 0.14332 cvalid: 0.10966 )
## iteration 5 particle 2 weighted err: 0.14781 (train: 0.13646 cvalid: 0.1081 )
## iteration 5 particle 3 weighted err: 0.19405 (train: 0.16423 cvalid: 0.08967 )
## iteration 5 particle 4 weighted err: 0.1644 (train: 0.14916 cvalid: 0.11106 )
## iteration 5 particle 5 weighted err: 0.15928 (train: 0.14552 cvalid: 0.11113 )
## iteration 5 particle 6 weighted err: 0.23815 (train: 0.19992 cvalid: 0.10437 )
## iteration 5 particle 7 weighted err: 0.15141 (train: 0.13915 cvalid: 0.10851 )
## iteration 5 particle 8 weighted err: 0.12789 (train: 0.12079 cvalid: 0.10304 )
## iteration 5 particle 9 weighted err: 0.121 (train: 0.11645 cvalid: 0.10509 )
## iteration 5 particle 10 weighted err: 0.543 (train: 0.52841 cvalid: 0.53753 )
## iteration 5 particle 11 weighted err: 0.12011 (train: 0.11639 cvalid: 0.10708 )
## iteration 5 particle 12 weighted err: 0.23061 (train: 0.19392 cvalid: 0.1022 )
## iteration 5 particle 13 weighted err: 0.10415 (train: 0.10081 cvalid: 0.1029 ) BEST MODEL KEPT
## iteration 5 particle 14 weighted err: 0.17604 (train: 0.15252 cvalid: 0.09373 )
## iteration 5 particle 15 weighted err: 0.13461 (train: 0.12747 cvalid: 0.10963 )</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">end.time &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span>()</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">'time ellapsed:'</span>, end.time <span class="op">-</span><span class="st"> </span>start.time, <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>))</a></code></pre></div>
<pre><code>## time ellapsed: 1.4992272734642</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">res &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(ymat, <span class="kw"><a href="../reference/automl_predict.html">automl_predict</a></span>(<span class="dt">model =</span> amlmodel, <span class="dt">X =</span> xmat))</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(res) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'actual'</span>, <span class="st">'predict'</span>)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(res)</a></code></pre></div>
<pre><code>##      actual  predict
## [1,]    5.1 5.027661
## [2,]    4.9 4.596144
## [3,]    4.7 4.717559
## [4,]    4.6 4.733640
## [5,]    5.0 5.113964
## [6,]    5.4 5.467246</code></pre>
<p>It’s even better, with no human efforts but machine time<br> Windows users won’t benefit from parallelization, the function uses parallel package included with R base…<br></p>
<h4 id="fit-a-regression-model-manually-hard-way" class="subsectionHead">
<span class="titlemark">0.3.3 </span> <span id="x1-130000.3.3"></span>fit a regression model experimentally (experimental way, Mix 2)
</h4>
<p>Same subject: predict Sepal.Length given other Iris parameters<br></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(iris)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">xmat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(iris[,<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>], <span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(iris<span class="op">$</span>Species)))</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">ymat &lt;-<span class="st"> </span>iris[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train_manual.html">automl_train_manual</a></span>(<span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat,</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">                                <span class="dt">hpar =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">modexec =</span> <span class="st">'trainwpso'</span>,</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">                                            <span class="dt">numiterations =</span> <span class="dv">30</span>,</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">                                            <span class="dt">psopartpopsize =</span> <span class="dv">50</span>))</a></code></pre></div>
<pre><code>## (cost: mse)
## cost epoch10: 0.0827230804228524 (cv cost: 0.0905949933685151) (LR:  0 ) 
## cost epoch20: 0.0742651449342831 (cv cost: 0.0820428875464537) (LR:  0 ) 
## cost epoch30: 0.073268785428924 (cv cost: 0.0759160345752076) (LR:  0 ) 
##    dim X: [4,135]
##    dim W1: [10,4] (min|max: -5.71510122702586, 9.43334015646581)
##    dim bB1: [10,1] (min|max: -0.139628718730307, 0.0615382424233414)
##    dim W2: [1,10] (min|max: -0.0537321480169208, 0.32227090072508)
##    dim bB2: [1,1] (min|max: 0.066365884761476, 0.066365884761476)
##    dim Y: [1,135]</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">res &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(ymat, <span class="kw"><a href="../reference/automl_predict.html">automl_predict</a></span>(<span class="dt">model =</span> amlmodel, <span class="dt">X =</span> xmat))</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(res) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'actual'</span>, <span class="st">'predict'</span>)</a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(res)</a></code></pre></div>
<pre><code>##      actual  predict
## [1,]    5.1 5.065030
## [2,]    4.9 4.469249
## [3,]    4.7 4.649156
## [4,]    4.6 4.646810
## [5,]    5.0 5.184187
## [6,]    5.4 5.692447</code></pre>
<p>Pretty good too, even better!<br></p>
<h4 id="fit-a-regression-model-manually-hard-way" class="subsectionHead">
<span class="titlemark">0.3.4 </span> <span id="x1-140000.3.4"></span>fit a regression model with custom cost (experimental way, Mix 2)
</h4>
<p>Same subject: predict Sepal.Length given other Iris parameters<br> Let’s try with Mean Absolute Percentage Error instead of Mean Square Error<br></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(iris)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">xmat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(iris[,<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>], <span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(iris<span class="op">$</span>Species)))</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">ymat &lt;-<span class="st"> </span>iris[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">f &lt;-<span class="st"> 'J=abs((y-yhat)/y)'</span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5">f &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(f, <span class="st">'J=sum(J[!is.infinite(J)],na.rm=TRUE)'</span>)</a>
<a class="sourceLine" id="cb19-6" data-line-number="6">f &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(f, <span class="st">'J=(J/length(y))'</span>)</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">f &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(f, <span class="dt">collapse =</span> <span class="st">';'</span>)</a>
<a class="sourceLine" id="cb19-8" data-line-number="8">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train_manual.html">automl_train_manual</a></span>(<span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat,</a>
<a class="sourceLine" id="cb19-9" data-line-number="9">                                <span class="dt">hpar =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">modexec =</span> <span class="st">'trainwpso'</span>,</a>
<a class="sourceLine" id="cb19-10" data-line-number="10">                                            <span class="dt">numiterations =</span> <span class="dv">30</span>,</a>
<a class="sourceLine" id="cb19-11" data-line-number="11">                                            <span class="dt">psopartpopsize =</span> <span class="dv">50</span>,</a>
<a class="sourceLine" id="cb19-12" data-line-number="12">                                            <span class="dt">costcustformul =</span> f))</a></code></pre></div>
<pre><code>## (cost: custom)
## cost epoch10: 0.0641352199927726 (cv cost: 0.0541888618566213) (LR:  0 ) 
## cost epoch20: 0.0582926167466713 (cv cost: 0.0523653406107709) (LR:  0 ) 
## cost epoch30: 0.0573700514993968 (cv cost: 0.0535607803292487) (LR:  0 ) 
##    dim X: [4,135]
##    dim W1: [10,4] (min|max: -9.05531100347454, 2.26590853900144)
##    dim bB1: [10,1] (min|max: -0.0601253304054113, 0.0399524442723589)
##    dim W2: [1,10] (min|max: -0.0292102857934989, 0.538940524656712)
##    dim bB2: [1,1] (min|max: 0.00164941620007934, 0.00164941620007934)
##    dim Y: [1,135]</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">res &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(ymat, <span class="kw"><a href="../reference/automl_predict.html">automl_predict</a></span>(<span class="dt">model =</span> amlmodel, <span class="dt">X =</span> xmat))</a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(res) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'actual'</span>, <span class="st">'predict'</span>)</a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(res)</a></code></pre></div>
<pre><code>##      actual  predict
## [1,]    5.1 5.056738
## [2,]    4.9 4.447762
## [3,]    4.7 4.639456
## [4,]    4.6 4.622778
## [5,]    5.0 5.177504
## [6,]    5.4 5.695871</code></pre>
<h4 id="fit-a-regression-model-manually-hard-way" class="subsectionHead">
<span class="titlemark">0.3.5 </span> <span id="x1-150000.3.5"></span>fit a classification model with softmax (Mix 2)
</h4>
<p>Subject: predict Species given other Iris parameters<br> Softmax is available with PSO, no derivative needed ;-)<br></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(iris)</a>
<a class="sourceLine" id="cb23-2" data-line-number="2">xmat =<span class="st"> </span>iris[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</a>
<a class="sourceLine" id="cb23-3" data-line-number="3">lab2pred &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(iris<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb23-4" data-line-number="4">lghlab &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(lab2pred)</a>
<a class="sourceLine" id="cb23-5" data-line-number="5">iris<span class="op">$</span>Species &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(iris<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb23-6" data-line-number="6">ymat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dt">from =</span> <span class="dv">1</span>, <span class="dt">to =</span> lghlab, <span class="dt">by =</span> <span class="dv">1</span>), <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(xmat), lghlab, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb23-7" data-line-number="7">ymat &lt;-<span class="st"> </span>(ymat <span class="op">==</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(iris<span class="op">$</span>Species)) <span class="op">+</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb23-8" data-line-number="8">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train_manual.html">automl_train_manual</a></span>(<span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat,</a>
<a class="sourceLine" id="cb23-9" data-line-number="9">                                <span class="dt">hpar =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">modexec =</span> <span class="st">'trainwpso'</span>,</a>
<a class="sourceLine" id="cb23-10" data-line-number="10">                                <span class="dt">layersshape =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">10</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb23-11" data-line-number="11">                                <span class="dt">layersacttype =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'relu'</span>, <span class="st">'softmax'</span>),</a>
<a class="sourceLine" id="cb23-12" data-line-number="12">                                <span class="dt">layersdropoprob =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb23-13" data-line-number="13">                                <span class="dt">numiterations =</span> <span class="dv">50</span>,</a>
<a class="sourceLine" id="cb23-14" data-line-number="14">                                <span class="dt">psopartpopsize =</span> <span class="dv">50</span>))</a></code></pre></div>
<pre><code>## (cost: crossentropy)
## cost epoch10: 0.870236074020942 (cv cost: 0.538739272849298) (LR:  0 ) 
## cost epoch20: 0.757282033049055 (cv cost: 0.512634130927213) (LR:  0 ) 
## cost epoch30: 0.665336489286255 (cv cost: 0.405940640471504) (LR:  0 ) 
## cost epoch40: 0.436565442235112 (cv cost: 0.304221712919552) (LR:  0 ) 
## cost epoch50: 0.396825986932571 (cv cost: 0.28317967654653) (LR:  0 ) 
##    dim X: [4,135]
##    dim W1: [10,4] (min|max: -10, 10)
##    dim bB1: [10,1] (min|max: -0.791357447569002, 0.935502029600105)
##    dim W2: [3,10] (min|max: -0.113304196183761, 3.64390040008716)
##    dim bB2: [3,1] (min|max: -0.711577511465429, 0.00524904114168052)
##    dim Y: [3,135]</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">res &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(ymat, <span class="kw"><a href="../reference/automl_predict.html">automl_predict</a></span>(<span class="dt">model =</span> amlmodel, <span class="dt">X =</span> xmat))</a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(res) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">'act'</span>,lab2pred, <span class="dt">sep =</span> <span class="st">'_'</span>),</a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">'pred'</span>,lab2pred, <span class="dt">sep =</span> <span class="st">'_'</span>))</a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(res)</a></code></pre></div>
<pre><code>##   act_setosa act_versicolor act_virginica pred_setosa pred_versicolor
## 1          1              0             0   1.0000000    8.642711e-09
## 2          1              0             0   0.9999999    9.965005e-08
## 3          1              0             0   0.9999999    8.375464e-08
## 4          1              0             0   0.9999905    9.540266e-06
## 5          1              0             0   1.0000000    1.988135e-08
## 6          1              0             0   0.9998780    1.219649e-04
##   pred_virginica
## 1   9.990892e-14
## 2   2.878130e-12
## 3   2.445253e-12
## 4   9.008365e-10
## 5   2.837706e-13
## 6   1.632819e-09</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">tail</a></span>(res)</a></code></pre></div>
<pre><code>##     act_setosa act_versicolor act_virginica  pred_setosa pred_versicolor
## 145          0              0             1 1.648190e-09       0.1269556
## 146          0              0             1 5.353088e-09       0.4713703
## 147          0              0             1 8.337667e-09       0.3215910
## 148          0              0             1 7.050169e-09       0.3423324
## 149          0              0             1 7.144629e-09       0.1171261
## 150          0              0             1 1.511101e-08       0.1304000
##     pred_virginica
## 145      0.8730444
## 146      0.5286297
## 147      0.6784090
## 148      0.6576676
## 149      0.8828739
## 150      0.8695999</code></pre>
<h4 id="fit-a-regression-model-manually-hard-way" class="subsectionHead">
<span class="titlemark">0.3.6 </span> <span id="x1-160000.3.6"></span>change the model parameters (shape …)
</h4>
<p>Same subject: predict Species given other Iris parameters<br> 1st example: with gradient descent and 2 hidden layers containing 10 nodes, with various activation functions for hidden layers<br></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(iris)</a>
<a class="sourceLine" id="cb29-2" data-line-number="2">xmat =<span class="st"> </span>iris[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</a>
<a class="sourceLine" id="cb29-3" data-line-number="3">lab2pred &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(iris<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb29-4" data-line-number="4">lghlab &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(lab2pred)</a>
<a class="sourceLine" id="cb29-5" data-line-number="5">iris<span class="op">$</span>Species &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(iris<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb29-6" data-line-number="6">ymat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dt">from =</span> <span class="dv">1</span>, <span class="dt">to =</span> lghlab, <span class="dt">by =</span> <span class="dv">1</span>), <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(xmat), lghlab, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb29-7" data-line-number="7">ymat &lt;-<span class="st"> </span>(ymat <span class="op">==</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(iris<span class="op">$</span>Species)) <span class="op">+</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb29-8" data-line-number="8">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train_manual.html">automl_train_manual</a></span>(</a>
<a class="sourceLine" id="cb29-9" data-line-number="9">                <span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat,</a>
<a class="sourceLine" id="cb29-10" data-line-number="10">                <span class="dt">hpar =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb29-11" data-line-number="11">                    <span class="dt">layersshape =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb29-12" data-line-number="12">                    <span class="dt">layersacttype =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'tanh'</span>, <span class="st">'relu'</span>, <span class="st">''</span>),</a>
<a class="sourceLine" id="cb29-13" data-line-number="13">                    <span class="dt">layersdropoprob =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)))</a></code></pre></div>
<pre><code>## (cost: crossentropy)
## cost epoch10: 1.71189614432236 (cv cost: 1.87093107817872) (LR:  0.001 ) 
## cost epoch20: 1.46539498970153 (cv cost: 1.60827685220873) (LR:  0.001 ) 
## cost epoch30: 1.51097359914267 (cv cost: 1.35829158526842) (LR:  0.001 ) 
## cost epoch40: 1.54885630861372 (cv cost: 1.13063792573005) (LR:  0.001 ) 
## cost epoch50: 1.5701919737473 (cv cost: 1.01013240092999) (LR:  0.001 ) 
##    dim X: [4,135]
##    dim W1: [10,4] (min|max: -0.992318461003706, 1.34989617707359)
##    dim bB1: [10,1] (min|max: -0.206069758132562, 0.253890502123614)
##    dim W2: [10,10] (min|max: -1.08700750868112, 1.26848630822546)
##    dim bB2: [10,1] (min|max: -0.0345749905577558, 0.274368217048584)
##    dim W3: [3,10] (min|max: -0.53483618820997, 0.201379256673472)
##    dim bB3: [3,1] (min|max: -0.0612170632863233, 0.00596096686809277)
##    dim Y: [3,135]</code></pre>
<p>nb: last activation type may be left to blank (it will be set automatically)<br><br> 2nd example: with gradient descent and no hidden layer (logistic regression)<br></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(iris)</a>
<a class="sourceLine" id="cb31-2" data-line-number="2">xmat =<span class="st"> </span>iris[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</a>
<a class="sourceLine" id="cb31-3" data-line-number="3">lab2pred &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(iris<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb31-4" data-line-number="4">lghlab &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(lab2pred)</a>
<a class="sourceLine" id="cb31-5" data-line-number="5">iris<span class="op">$</span>Species &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(iris<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb31-6" data-line-number="6">ymat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dt">from =</span> <span class="dv">1</span>, <span class="dt">to =</span> lghlab, <span class="dt">by =</span> <span class="dv">1</span>), <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(xmat), lghlab, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb31-7" data-line-number="7">ymat &lt;-<span class="st"> </span>(ymat <span class="op">==</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(iris<span class="op">$</span>Species)) <span class="op">+</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb31-8" data-line-number="8">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train_manual.html">automl_train_manual</a></span>(<span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat,</a>
<a class="sourceLine" id="cb31-9" data-line-number="9">                <span class="dt">hpar =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">layersshape =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb31-10" data-line-number="10">                    <span class="dt">layersacttype =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'sigmoid'</span>),</a>
<a class="sourceLine" id="cb31-11" data-line-number="11">                    <span class="dt">layersdropoprob =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>)))</a></code></pre></div>
<pre><code>## (cost: crossentropy)
## cost epoch10: 1.99625400356964 (cv cost: 1.96668349911798) (LR:  0.001 ) 
## cost epoch20: 1.80623664408059 (cv cost: 1.88055968458769) (LR:  0.001 ) 
## cost epoch30: 1.7129547023897 (cv cost: 1.83222758233555) (LR:  0.001 ) 
## cost epoch40: 1.65986375013556 (cv cost: 1.79683014575606) (LR:  0.001 ) 
## cost epoch50: 1.62852986670403 (cv cost: 1.76958091833677) (LR:  0.001 ) 
##    dim X: [4,135]
##    dim W1: [3,4] (min|max: -0.287822586802553, 0.0745329912660817)
##    dim bB1: [3,1] (min|max: -0.0565657905949928, 0.00110157423432543)
##    dim Y: [3,135]</code></pre>
<p>We saved the model to continue training later (see below in next section)</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">amlmodelsaved &lt;-<span class="st"> </span>amlmodel</a></code></pre></div>
<h4 id="fit-a-regression-model-manually-hard-way" class="subsectionHead">
<span class="titlemark">0.3.7 </span> <span id="x1-170000.3.7"></span>continue training on saved model (fine tuning …)
</h4>
<p>Subject: continue training on saved model (model saved above in last section)<br></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train_manual.html">automl_train_manual</a></span>(<span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat,</a>
<a class="sourceLine" id="cb34-2" data-line-number="2">                <span class="dt">hpar =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">numiterations =</span> <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb34-3" data-line-number="3">                    <span class="dt">psopartpopsize =</span> <span class="dv">50</span>),</a>
<a class="sourceLine" id="cb34-4" data-line-number="4">                <span class="dt">mdlref =</span> amlmodelsaved)</a></code></pre></div>
<pre><code>## (cost: crossentropy)
## cost epoch10: 1.64939345678508 (cv cost: 1.71937333380575) (LR:  0.001 ) 
## cost epoch20: 1.59222961498199 (cv cost: 1.68871980974644) (LR:  0.001 ) 
## cost epoch30: 1.55920723100684 (cv cost: 1.66301770657286) (LR:  0.001 ) 
## cost epoch40: 1.53753479283443 (cv cost: 1.63906547412896) (LR:  0.001 ) 
## cost epoch50: 1.52142303375345 (cv cost: 1.61605959302094) (LR:  0.001 ) 
## cost epoch60: 1.5083504142276 (cv cost: 1.59378034170119) (LR:  0.001 ) 
## cost epoch70: 1.49709713220979 (cv cost: 1.57217010517658) (LR:  0.001 ) 
## cost epoch80: 1.48702147224837 (cv cost: 1.55121668496295) (LR:  0.001 ) 
## cost epoch90: 1.47776257083127 (cv cost: 1.53091751538077) (LR:  0.001 ) 
## cost epoch100: 1.46994872480746 (cv cost: 1.51320448300005) (LR:  0.001 ) 
##    dim X: [4,135]
##    dim W1: [3,4] (min|max: -0.58898107691444, 0.272038569275488)
##    dim bB1: [3,1] (min|max: -0.142270510796367, 0.0595738450840597)
##    dim Y: [3,135]</code></pre>
<p>We can see the error continuing to decrease from last training<br> The training continued with the same parameters, but notice that we were able to change the number of iterations<br></p>
<h4 id="fit-a-regression-model-manually-hard-way" class="subsectionHead">
<span class="titlemark">0.3.8 </span> <span id="x1-180000.3.8"></span>use the 2 steps automatic approach
</h4>
<p>Same subject: predict Species given other Iris parameters<br> Let’s try the automatic approach in 2 steps with the same Logistic Regression architecture;<br> 1st step goal is performance, overfitting<br> 2nd step is robustness, regularization<br></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(iris)</a>
<a class="sourceLine" id="cb36-2" data-line-number="2">xmat =<span class="st"> </span>iris[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</a>
<a class="sourceLine" id="cb36-3" data-line-number="3">lab2pred &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(iris<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb36-4" data-line-number="4">lghlab &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(lab2pred)</a>
<a class="sourceLine" id="cb36-5" data-line-number="5">iris<span class="op">$</span>Species &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(iris<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb36-6" data-line-number="6">ymat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dt">from =</span> <span class="dv">1</span>, <span class="dt">to =</span> lghlab, <span class="dt">by =</span> <span class="dv">1</span>), <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(xmat), lghlab, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb36-7" data-line-number="7">ymat &lt;-<span class="st"> </span>(ymat <span class="op">==</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(iris<span class="op">$</span>Species)) <span class="op">+</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb36-8" data-line-number="8">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train.html">automl_train</a></span>(<span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat,</a>
<a class="sourceLine" id="cb36-9" data-line-number="9">                <span class="dt">hpar =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">layersshape =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb36-10" data-line-number="10">                   <span class="dt">layersacttype =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'sigmoid'</span>),</a>
<a class="sourceLine" id="cb36-11" data-line-number="11">                   <span class="dt">layersdropoprob =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>)),</a>
<a class="sourceLine" id="cb36-12" data-line-number="12">                <span class="dt">autopar =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">auto_runtype =</span> <span class="st">'2steps'</span>))</a></code></pre></div>
<pre><code>## STEP: 1 (overfitting)
## (cost: crossentropy)
## iteration 1 particle 1 weighted err: 1.89223 BEST MODEL KEPT
## iteration 1 particle 2 weighted err: 2.01374
## iteration 1 particle 3 weighted err: 1.98038
## iteration 1 particle 4 weighted err: 2.06968
## iteration 1 particle 5 weighted err: 1.86284 BEST MODEL KEPT
## iteration 1 particle 6 weighted err: 2.08126
## iteration 1 particle 7 weighted err: 1.92107
## iteration 1 particle 8 weighted err: 1.79115 BEST MODEL KEPT
## iteration 2 particle 1 weighted err: 1.89223
## iteration 2 particle 2 weighted err: 1.97729
## iteration 2 particle 3 weighted err: 1.78583 BEST MODEL KEPT
## iteration 2 particle 4 weighted err: 2.02162
## iteration 2 particle 5 weighted err: 1.78917
## iteration 2 particle 6 weighted err: 1.99649
## iteration 2 particle 7 weighted err: 1.82008
## iteration 2 particle 8 weighted err: 1.79115
## iteration 3 particle 1 weighted err: 1.76979 BEST MODEL KEPT
## iteration 3 particle 2 weighted err: 1.84428
## iteration 3 particle 3 weighted err: 1.65681 BEST MODEL KEPT
## iteration 3 particle 4 weighted err: 1.94741
## iteration 3 particle 5 weighted err: 1.76721
## iteration 3 particle 6 weighted err: 1.97101
## iteration 3 particle 7 weighted err: 1.79742
## iteration 3 particle 8 weighted err: 1.79115
## STEP: 2 (regularization)
## (cost: crossentropy)
## iteration 1 particle 1 weighted err: 1.8825 (train: 1.86862 cvalid: 1.83392 ) BEST MODEL KEPT
## iteration 1 particle 2 weighted err: 1.87967 (train: 1.86508 cvalid: 1.82863 ) BEST MODEL KEPT
## iteration 1 particle 3 weighted err: 1.94153 (train: 1.93027 cvalid: 1.90212 )
## iteration 1 particle 4 weighted err: 1.74796 (train: 1.74723 cvalid: 1.7454 ) BEST MODEL KEPT
## iteration 1 particle 5 weighted err: 1.79112 (train: 1.7849 cvalid: 1.76937 )
## iteration 1 particle 6 weighted err: 1.88973 (train: 1.87743 cvalid: 1.84668 )
## iteration 1 particle 7 weighted err: 2.03988 (train: 2.02659 cvalid: 1.99337 )
## iteration 1 particle 8 weighted err: 1.8257 (train: 1.81894 cvalid: 1.80204 )
## iteration 2 particle 1 weighted err: 1.73252 (train: 1.72937 cvalid: 1.72148 ) BEST MODEL KEPT
## iteration 2 particle 2 weighted err: 1.70953 (train: 1.67906 cvalid: 1.6981 ) BEST MODEL KEPT
## iteration 2 particle 3 weighted err: 1.75612 (train: 1.73784 cvalid: 1.74927 )
## iteration 2 particle 4 weighted err: 1.71942 (train: 1.68315 cvalid: 1.70582 )
## iteration 2 particle 5 weighted err: 1.79112 (train: 1.7849 cvalid: 1.76937 )
## iteration 2 particle 6 weighted err: 1.88973 (train: 1.87743 cvalid: 1.84668 )
## iteration 2 particle 7 weighted err: 1.82257 (train: 1.81428 cvalid: 1.79356 )
## iteration 2 particle 8 weighted err: 1.8257 (train: 1.81894 cvalid: 1.80204 )
## iteration 3 particle 1 weighted err: 1.70099 (train: 1.69381 cvalid: 1.6983 ) BEST MODEL KEPT
## iteration 3 particle 2 weighted err: 1.70665 (train: 1.6696 cvalid: 1.69276 )
## iteration 3 particle 3 weighted err: 1.73878 (train: 1.6778 cvalid: 1.71591 )
## iteration 3 particle 4 weighted err: 1.71942 (train: 1.68315 cvalid: 1.70582 )
## iteration 3 particle 5 weighted err: 1.79112 (train: 1.7849 cvalid: 1.76937 )
## iteration 3 particle 6 weighted err: 1.75088 (train: 1.74261 cvalid: 1.74778 )
## iteration 3 particle 7 weighted err: 1.72825 (train: 1.6841 cvalid: 1.71169 )
## iteration 3 particle 8 weighted err: 1.8257 (train: 1.81894 cvalid: 1.80204 )</code></pre>
<p>Compared to the last runs (in previous sections above), difference between train and cross validation errors is much more tenuous<br> Automatically :-)<br></p>
<h3 id="todo-list-idea" class="sectionHead">
<span class="titlemark">0.4 </span> <span id="x1-190000.4"></span>ToDo List idea
</h3>
<p>
</p>
<ul>
<li>review the code to object oriented<br>
</li>
<li>manage transfert learning from existing frameworks<br>
</li>
<li>implement CNN<br>
</li>
<li>implement RNN<br>
</li>
<li>…<br><br> -&gt; I won’t do it alone, let’s create a team !<br><a href="https://aboulaboul.github.io/automl" class="uri">https://aboulaboul.github.io/automl</a> <br><a href="https://github.com/aboulaboul/automl" class="uri">https://github.com/aboulaboul/automl</a>


</li>
</ul>
</div>
</div>
</div>
</body>
</html><html>
<div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

      </div>
<footer><div class="copyright">
  <p>Developed by Alex Boulangé.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.0.</p>
</div>

      </footer>
</html>
