<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>automl • automl</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="automl">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">automl</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.2.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/automl.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>automl</h1>
                        <h4 class="author">Alex Boulangé</h4>
            
            <h4 class="date">january 27, 2019</h4>
      
      
      <div class="hidden name"><code>automl.Rmd</code></div>

    </div>

    
    

<h2 id="contents" class="likechapterHead">
<span id="x1-1000"></span>Contents
</h2>
<div class="tableofcontents">
<p> <span class="sectionToc">0.1 <a href="#x1-20000.1" id="QQ2-1-2">Introduction to automl package</a></span><br>  <span class="sectionToc">0.2 <a href="#x1-30000.2" id="QQ2-1-3">Why &amp; how automl</a></span><br>   <span class="subsectionToc">0.2.1 <a href="#x1-40000.2.1" id="QQ2-1-4">Deep Learning existing frameworks, disadvantages</a></span><br>   <span class="subsectionToc">0.2.2 <a href="#x1-50000.2.2" id="QQ2-1-5">Neural Network - Deep Learning, disadvantages</a></span><br>   <span class="subsectionToc">0.2.3 <a href="#x1-60000.2.3" id="QQ2-1-6">Metaheuristic - PSO, benefits</a></span><br>   <span class="subsectionToc">0.2.4 <a href="#x1-70000.2.4" id="QQ2-1-7">Birth of automl package</a></span><br>   <span class="subsectionToc">0.2.5 <a href="#x1-80000.2.5" id="QQ2-1-8">Mix 1: hyperparameters tuning with PSO</a></span><br>   <span class="subsectionToc">0.2.6 <a href="#x1-90000.2.6" id="QQ2-1-9">Mix 2: PSO instead of gradient descent</a></span><br>  <span class="sectionToc">0.3 <a href="#x1-100000.3" id="QQ2-1-10">First steps: How to</a></span><br>   <span class="subsectionToc">0.3.1 <a href="#x1-110000.3.1" id="QQ2-1-11">fit a regression model manually (hard way)</a></span><br>   <span class="subsectionToc">0.3.2 <a href="#x1-120000.3.2" id="QQ2-1-12">fit a regression model automatically (easy way, Mix 1)</a></span><br>   <span class="subsectionToc">0.3.3 <a href="#x1-130000.3.3" id="QQ2-1-13">fit a regression model experimentally (experimental way, Mix 2)</a></span><br>   <span class="subsectionToc">0.3.4 <a href="#x1-140000.3.4" id="QQ2-1-14">fit a regression model with custom cost (experimental way, Mix 2)</a></span><br>   <span class="subsectionToc">0.3.5 <a href="#x1-150000.3.5" id="QQ2-1-15">fit a classification model with softmax (Mix 2)</a></span><br>   <span class="subsectionToc">0.3.6 <a href="#x1-160000.3.6" id="QQ2-1-16">change the model parameters (shape …)</a></span><br>   <span class="subsectionToc">0.3.7 <a href="#x1-170000.3.7" id="QQ2-1-17">continue training on saved model (fine tuning …)</a></span><br>   <span class="subsectionToc">0.3.8 <a href="#x1-180000.3.8" id="QQ2-1-18">use the 2 steps automatic approach</a></span><br>  <span class="sectionToc">0.4 <a href="#x1-190000.4" id="QQ2-1-19">ToDo List</a></span></p>
</div>
<h3 id="introduction-to-automl-package" class="sectionHead">
<span class="titlemark">0.1 </span> <span id="x1-20000.1"></span>Introduction to automl package
</h3>
<p>
This document is intended to answer the following questions; why &amp; how automl and how to use it<br><br> automl package provides:<br> -Deep Learning last tricks (those who have taken Andrew NG’s MOOC on Coursera will be in familiar territory)<br> -hyperparameters autotune with metaheuristic (PSO)<br> -experimental stuff and more to come (you’re welcome as coauthor!)<br></p>
<h3 id="why-how-automl" class="sectionHead">
<span class="titlemark">0.2 </span> <span id="x1-30000.2"></span>Why &amp; how automl
</h3>
<h4 id="deep-learning-existing-frameworks-disadvantages" class="subsectionHead">
<span class="titlemark">0.2.1 </span> <span id="x1-40000.2.1"></span>Deep Learning existing frameworks, disadvantages
</h4>
<p>
Deploying and maintaining most Deep Learning frameworks means: Python…<br> R language is so simple to install and maintain in production environments that it is obvious to use a pure R based package for deep learning !<br></p>
<h4 id="neural-network---deep-learning-disadvantages" class="subsectionHead">
<span class="titlemark">0.2.2 </span> <span id="x1-50000.2.2"></span>Neural Network - Deep Learning, disadvantages
</h4>
<p>
Disadvantages :<br> 1st disadvantage: you have to test manually different combinations of parameters (number of layers, nodes, activation function, etc …) and then also tune manually hyper parameters for training (learning rate, momentum, mini batch size, etc …)<br> 2nd disadvantage: only for those who are not mathematicians, calculating derivative in case of new cost or activation function, may by an issue.<br><br><img src="imgperc001.png" alt="PIC"><br></p>
<h4 id="metaheuristic---pso-benefits" class="subsectionHead">
<span class="titlemark">0.2.3 </span> <span id="x1-60000.2.3"></span>Metaheuristic - PSO, benefits
</h4>
<p>
The Particle Swarm Optimization algorithm is a great and simple one.<br> In a few words, the first step consists in throwing randomly a set of particles in a space and the next steps consist in discovering the best solution while converging.<br><img src="imgperc002.png" alt="PIC"><br> video tutorial from Yarpiz is a great ressource<br></p>
<h4 id="birth-of-automl-package" class="subsectionHead">
<span class="titlemark">0.2.4 </span> <span id="x1-70000.2.4"></span>Birth of automl package
</h4>
<p>
automl package was born from the idea to use metaheuristic PSO to address the identified disadvantages above.<br> And last but not the least reason: use R and R only :-)<br> 3 functions are available:<br> - automl_train_manual: the manual mode to train a model<br> - automl_train: the automatic mode to train model<br> - automl_predict: the prediction function to apply a trained model on datas<br></p>
<h4 id="mix-1-hyperparameters-tuning-with-pso" class="subsectionHead">
<span class="titlemark">0.2.5 </span> <span id="x1-80000.2.5"></span>Mix 1: hyperparameters tuning with PSO
</h4>
<p>
Mix 1 consists in using PSO algorithm to optimize the hyperparameters: each particle corresponds to a set of hyperparameters.<br> The automl_train function was made to do that.<br><br><img src="imgperc003.png" alt="PIC"><br></p>
<h4 id="mix-2-pso-instead-of-gradient-descent" class="subsectionHead">
<span class="titlemark">0.2.6 </span> <span id="x1-90000.2.6"></span>Mix 2: PSO instead of gradient descent
</h4>
<p>
Mix 2 is experimental, it consists in using PSO algorithm to optimize the weights of Neural Network in place of gradient descent: each particle corresponds to a set of neural network weights matrices.<br> The automl_train_manual function do that too.<br><br><img src="imgperc004.png" alt="PIC"><br></p>
<h3 id="first-steps-how-to" class="sectionHead">
<span class="titlemark">0.3 </span> <span id="x1-100000.3"></span>First steps: How to
</h3>
<p>
For those who will laugh at seeing deep learning with one hidden layer and the Iris data set of 150 records, I will say: you’re perfectly right :-)<br> The goal at this stage is simply to take the first steps
</p>
<h4 id="fit-a-regression-model-manually-hard-way" class="subsectionHead">
<span class="titlemark">0.3.1 </span> <span id="x1-110000.3.1"></span>fit a regression model manually (hard way)
</h4>
<p>
Subject: predict Sepal.Length given other Iris parameters<br> 1st with gradient descent and default hyperparameters value for learning rate (0.001) and mini batch size (32)<br></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">data</span>(iris)</a>
<a class="sourceLine" id="cb1-2" title="2">xmat &lt;-<span class="st"> </span><span class="kw">cbind</span>(iris[,<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>], <span class="kw">as.numeric</span>(iris<span class="op">$</span>Species))</a>
<a class="sourceLine" id="cb1-3" title="3">ymat &lt;-<span class="st"> </span>iris[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb1-4" title="4">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train_manual.html">automl_train_manual</a></span>(<span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat)</a></code></pre></div>
<pre><code>## (cost: mse)
## cost epoch10: 20.9340400047156 (cv cost: 25.205632342013) (LR:  0.001 ) 
## cost epoch20: 20.6280923387762 (cv cost: 23.8214521197268) (LR:  0.001 ) 
## cost epoch30: 20.3222407903838 (cv cost: 22.1899741289456) (LR:  0.001 ) 
## cost epoch40: 20.0217966054298 (cv cost: 21.3908446693146) (LR:  0.001 ) 
## cost epoch50: 19.7584058034009 (cv cost: 20.7170232035934) (LR:  0.001 ) 
##    dim X: [4,135]
##    dim W1: [10,4] (min|max: -1.7491071951295, 1.81621228893733)
##    dim bB1: [10,1] (min|max: -0.147332564945795, 0.0570244572705301)
##    dim j1: [10,1] (min|max: 0.906596236812877, 1.06780350658908)
##    dim W2: [1,10] (min|max: -0.0297138422581393, 0.0225329925000395)
##    dim bB2: [1,1] (min|max: 0.216274212807187, 0.216274212807187)
##    dim j2: [1,1] (min|max: 0.896170058073578, 0.896170058073578)
##    dim Y: [1,135]</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">res &lt;-<span class="st"> </span><span class="kw">cbind</span>(ymat, <span class="kw"><a href="../reference/automl_predict.html">automl_predict</a></span>(<span class="dt">model =</span> amlmodel, <span class="dt">X =</span> xmat))</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">colnames</span>(res) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'actual'</span>, <span class="st">'predict'</span>)</a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw">head</span>(res)</a></code></pre></div>
<pre><code>##      actual   predict
## [1,]    5.1 -2.063614
## [2,]    4.9 -2.487673
## [3,]    4.7 -2.471912
## [4,]    4.6 -2.281035
## [5,]    5.0 -1.956937
## [6,]    5.4 -1.729314</code></pre>
<p>:-[] no pain, no gain …<br> After some manual fine tuning on learning rate, mini batch size and iterations number (epochs):<br></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">data</span>(iris)</a>
<a class="sourceLine" id="cb5-2" title="2">xmat &lt;-<span class="st"> </span><span class="kw">cbind</span>(iris[,<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>], <span class="kw">as.numeric</span>(iris<span class="op">$</span>Species))</a>
<a class="sourceLine" id="cb5-3" title="3">ymat &lt;-<span class="st"> </span>iris[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb5-4" title="4">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train_manual.html">automl_train_manual</a></span>(<span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat,</a>
<a class="sourceLine" id="cb5-5" title="5">                                <span class="dt">hpar =</span> <span class="kw">list</span>(<span class="dt">learningrate =</span> <span class="fl">0.01</span>,</a>
<a class="sourceLine" id="cb5-6" title="6">                                <span class="dt">minibatchsize =</span> <span class="dv">2</span><span class="op">^</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb5-7" title="7">                                <span class="dt">numiterations =</span> <span class="dv">30</span>))</a></code></pre></div>
<pre><code>## (cost: mse)
## cost epoch10: 5.55679482839698 (cv cost: 4.87492997304325) (LR:  0.01 ) 
## cost epoch20: 1.64996951479802 (cv cost: 1.50339773126712) (LR:  0.01 ) 
## cost epoch30: 0.647727077375946 (cv cost: 0.60142564484723) (LR:  0.01 ) 
##    dim X: [4,135]
##    dim W1: [10,4] (min|max: -1.98507776416897, 1.97659598029097)
##    dim bB1: [10,1] (min|max: -0.861796459549848, 1.31208805654204)
##    dim j1: [10,1] (min|max: -0.186679447292938, 2.12680721214952)
##    dim W2: [1,10] (min|max: -0.400821465269633, 0.271454318518162)
##    dim bB2: [1,1] (min|max: 5.20448636682865, 5.20448636682865)
##    dim j2: [1,1] (min|max: 0.353886604123629, 0.353886604123629)
##    dim Y: [1,135]</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">res &lt;-<span class="st"> </span><span class="kw">cbind</span>(ymat, <span class="kw"><a href="../reference/automl_predict.html">automl_predict</a></span>(<span class="dt">model =</span> amlmodel, <span class="dt">X =</span> xmat))</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">colnames</span>(res) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'actual'</span>, <span class="st">'predict'</span>)</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">head</span>(res)</a></code></pre></div>
<pre><code>##      actual  predict
## [1,]    5.1 4.478478
## [2,]    4.9 4.215683
## [3,]    4.7 4.275902
## [4,]    4.6 4.313141
## [5,]    5.0 4.531038
## [6,]    5.4 4.742847</code></pre>
<p>Better result, but with human efforts!<br></p>
<h4 id="fit-a-regression-model-manually-hard-way" class="subsectionHead">
<span class="titlemark">0.3.2 </span> <span id="x1-120000.3.2"></span>fit a regression model automatically (easy way, Mix 1)
</h4>
<p>Same subject: predict Sepal.Length given other Iris parameters<br></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">data</span>(iris)</a>
<a class="sourceLine" id="cb9-2" title="2">xmat &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">cbind</span>(iris[,<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>], <span class="kw">as.numeric</span>(iris<span class="op">$</span>Species)))</a>
<a class="sourceLine" id="cb9-3" title="3">ymat &lt;-<span class="st"> </span>iris[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb9-4" title="4">start.time &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</a>
<a class="sourceLine" id="cb9-5" title="5">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train.html">automl_train</a></span>(<span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat,</a>
<a class="sourceLine" id="cb9-6" title="6">                         <span class="dt">autopar =</span> <span class="kw">list</span>(<span class="dt">psopartpopsize =</span> <span class="dv">15</span>,</a>
<a class="sourceLine" id="cb9-7" title="7">                                        <span class="dt">numiterations =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb9-8" title="8">                                        <span class="dt">auto_layers_max =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb9-9" title="9">                                        <span class="dt">nbcores =</span> <span class="dv">4</span>))</a></code></pre></div>
<pre><code>## (cost: mse)
## iteration 1 particle 1 weighted err: 22.20611 (train: 20.93004 cvalid: 17.73985 ) BEST MODEL KEPT
## iteration 1 particle 2 weighted err: 21.48398 (train: 20.87709 cvalid: 19.35987 ) BEST MODEL KEPT
## iteration 1 particle 3 weighted err: 22.98075 (train: 20.96822 cvalid: 15.9369 )
## iteration 1 particle 4 weighted err: 22.64428 (train: 21.44958 cvalid: 22.19627 )
## iteration 1 particle 5 weighted err: 22.03677 (train: 20.83123 cvalid: 17.81739 )
## iteration 1 particle 6 weighted err: 22.30679 (train: 21.02051 cvalid: 17.80482 )
## iteration 1 particle 7 weighted err: 22.15835 (train: 20.67513 cvalid: 16.96709 )
## iteration 1 particle 8 weighted err: 21.04265 (train: 20.1281 cvalid: 17.84174 ) BEST MODEL KEPT
## iteration 1 particle 9 weighted err: 21.0425 (train: 20.72162 cvalid: 19.91941 ) BEST MODEL KEPT
## iteration 1 particle 10 weighted err: 13.78127 (train: 13.54355 cvalid: 12.94923 ) BEST MODEL KEPT
## iteration 1 particle 11 weighted err: 20.34595 (train: 19.54807 cvalid: 17.55337 )
## iteration 1 particle 12 weighted err: 21.86865 (train: 20.99222 cvalid: 18.80114 )
## iteration 1 particle 13 weighted err: 14.11782 (train: 13.54468 cvalid: 12.11184 )
## iteration 1 particle 14 weighted err: 23.71203 (train: 20.88439 cvalid: 13.81528 )
## iteration 1 particle 15 weighted err: 22.20701 (train: 20.90727 cvalid: 17.65792 )
## iteration 2 particle 1 weighted err: 17.28484 (train: 17.05718 cvalid: 16.48803 )
## iteration 2 particle 2 weighted err: 20.34511 (train: 19.54902 cvalid: 17.55877 )
## iteration 2 particle 3 weighted err: 18.15141 (train: 17.30269 cvalid: 15.18087 )
## iteration 2 particle 4 weighted err: 18.5541 (train: 18.20259 cvalid: 17.32379 )
## iteration 2 particle 5 weighted err: 6.25782 (train: 6.12291 cvalid: 5.78564 ) BEST MODEL KEPT
## iteration 2 particle 6 weighted err: 21.35519 (train: 20.47036 cvalid: 18.25828 )
## iteration 2 particle 7 weighted err: 13.75975 (train: 12.98786 cvalid: 11.05813 )
## iteration 2 particle 8 weighted err: 21.04265 (train: 20.1281 cvalid: 17.84174 )
## iteration 2 particle 9 weighted err: 2.17826 (train: 1.03059 cvalid: 1.74789 ) BEST MODEL KEPT
## iteration 2 particle 10 weighted err: 13.78127 (train: 13.54355 cvalid: 12.94923 )
## iteration 2 particle 11 weighted err: 1.4612 (train: 0.54284 cvalid: 1.11682 ) BEST MODEL KEPT
## iteration 2 particle 12 weighted err: 18.88923 (train: 18.61216 cvalid: 17.91948 )
## iteration 2 particle 13 weighted err: 14.11782 (train: 13.54468 cvalid: 12.11184 )
## iteration 2 particle 14 weighted err: 21.46543 (train: 20.5646 cvalid: 18.31253 )
## iteration 2 particle 15 weighted err: 14.74928 (train: 14.56655 cvalid: 14.10972 )
## iteration 3 particle 1 weighted err: 17.28484 (train: 17.05718 cvalid: 16.48803 )
## iteration 3 particle 2 weighted err: 20.34511 (train: 19.54902 cvalid: 17.55877 )
## iteration 3 particle 3 weighted err: 0.76426 (train: 0.01617 cvalid: 0.48373 ) BEST MODEL KEPT
## iteration 3 particle 4 weighted err: 18.5541 (train: 18.20259 cvalid: 17.32379 )
## iteration 3 particle 5 weighted err: 6.25782 (train: 6.12291 cvalid: 5.78564 )
## iteration 3 particle 6 weighted err: 17.89662 (train: 17.65917 cvalid: 17.06555 )
## iteration 3 particle 7 weighted err: 13.75975 (train: 12.98786 cvalid: 11.05813 )
## iteration 3 particle 8 weighted err: 5.0488 (train: 4.92663 cvalid: 4.62118 )
## iteration 3 particle 9 weighted err: 2.17826 (train: 1.03059 cvalid: 1.74789 )
## iteration 3 particle 10 weighted err: 12.71182 (train: 12.48331 cvalid: 11.91204 )
## iteration 3 particle 11 weighted err: 1.4612 (train: 0.54284 cvalid: 1.11682 )
## iteration 3 particle 12 weighted err: 18.88923 (train: 18.61216 cvalid: 17.91948 )
## iteration 3 particle 13 weighted err: 0.6469 (train: 0.02339 cvalid: 0.41308 ) BEST MODEL KEPT
## iteration 3 particle 14 weighted err: 19.09523 (train: 18.19735 cvalid: 15.95267 )
## iteration 3 particle 15 weighted err: 14.74928 (train: 14.56655 cvalid: 14.10972 )
## iteration 4 particle 1 weighted err: 12.94662 (train: 4.40029 cvalid: 9.74174 )
## iteration 4 particle 2 weighted err: 18.67702 (train: 17.28413 cvalid: 18.15469 )
## iteration 4 particle 3 weighted err: 0.76426 (train: 0.01617 cvalid: 0.48373 )
## iteration 4 particle 4 weighted err: 11.2243 (train: 11.00578 cvalid: 10.45947 )
## iteration 4 particle 5 weighted err: 1.93528 (train: 0.00141 cvalid: 1.21008 )
## iteration 4 particle 6 weighted err: 17.89662 (train: 17.65917 cvalid: 17.06555 )
## iteration 4 particle 7 weighted err: 0.49851 (train: 0.42819 cvalid: 0.47214 ) BEST MODEL KEPT
## iteration 4 particle 8 weighted err: 0.91373 (train: 0.00154 cvalid: 0.57166 )
## iteration 4 particle 9 weighted err: 0.93498 (train: 0.92789 cvalid: 0.91017 )
## iteration 4 particle 10 weighted err: 8.31684 (train: 8.15595 cvalid: 7.75375 )
## iteration 4 particle 11 weighted err: 1.4612 (train: 0.54284 cvalid: 1.11682 )
## iteration 4 particle 12 weighted err: 16.48857 (train: 16.22736 cvalid: 15.57431 )
## iteration 4 particle 13 weighted err: 0.6469 (train: 0.02339 cvalid: 0.41308 )
## iteration 4 particle 14 weighted err: 6.071 (train: 1.5917 cvalid: 4.39126 )
## iteration 4 particle 15 weighted err: 7.21248 (train: 0.12135 cvalid: 4.55331 )
## iteration 5 particle 1 weighted err: 7.08302 (train: 6.57048 cvalid: 5.28913 )
## iteration 5 particle 2 weighted err: 7.71355 (train: 7.25568 cvalid: 6.11101 )
## iteration 5 particle 3 weighted err: 0.74873 (train: 0.00073 cvalid: 0.46823 )
## iteration 5 particle 4 weighted err: 10.69926 (train: 10.14015 cvalid: 8.74239 )
## iteration 5 particle 5 weighted err: 1.93528 (train: 0.00141 cvalid: 1.21008 )
## iteration 5 particle 6 weighted err: 16.99977 (train: 9.15757 cvalid: 14.05894 )
## iteration 5 particle 7 weighted err: 0.49851 (train: 0.42819 cvalid: 0.47214 )
## iteration 5 particle 8 weighted err: 0.91373 (train: 0.00154 cvalid: 0.57166 )
## iteration 5 particle 9 weighted err: 0.93498 (train: 0.92789 cvalid: 0.91017 )
## iteration 5 particle 10 weighted err: 2.35178 (train: 2.29943 cvalid: 2.16857 )
## iteration 5 particle 11 weighted err: 0.65705 (train: 0.59243 cvalid: 0.63282 )
## iteration 5 particle 12 weighted err: 16.48857 (train: 16.22736 cvalid: 15.57431 )
## iteration 5 particle 13 weighted err: 0.6469 (train: 0.02339 cvalid: 0.41308 )
## iteration 5 particle 14 weighted err: 6.071 (train: 1.5917 cvalid: 4.39126 )
## iteration 5 particle 15 weighted err: 5.15812 (train: 4.72209 cvalid: 3.63203 )</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">end.time &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw">cat</span>(<span class="kw">paste</span>(<span class="st">'time ellapsed:'</span>, end.time <span class="op">-</span><span class="st"> </span>start.time, <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>))</a></code></pre></div>
<pre><code>## time ellapsed: 2.45968851645788</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">res &lt;-<span class="st"> </span><span class="kw">cbind</span>(ymat, <span class="kw"><a href="../reference/automl_predict.html">automl_predict</a></span>(<span class="dt">model =</span> amlmodel, <span class="dt">X =</span> xmat))</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">colnames</span>(res) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'actual'</span>, <span class="st">'predict'</span>)</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="kw">head</span>(res)</a></code></pre></div>
<pre><code>##      actual  predict
## [1,]    5.1 4.975551
## [2,]    4.9 4.667541
## [3,]    4.7 4.735524
## [4,]    4.6 4.784364
## [5,]    5.0 5.037152
## [6,]    5.4 5.325999</code></pre>
<p>It’s even better, with no human efforts but machine time<br> Windows users won’t benefit from parallelization, the function uses parallel package included with R base…<br></p>
<h4 id="fit-a-regression-model-manually-hard-way" class="subsectionHead">
<span class="titlemark">0.3.3 </span> <span id="x1-130000.3.3"></span>fit a regression model experimentally (experimental way, Mix 2)
</h4>
<p>Same subject: predict Sepal.Length given other Iris parameters<br></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">data</span>(iris)</a>
<a class="sourceLine" id="cb15-2" title="2">xmat &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">cbind</span>(iris[,<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>], <span class="kw">as.numeric</span>(iris<span class="op">$</span>Species)))</a>
<a class="sourceLine" id="cb15-3" title="3">ymat &lt;-<span class="st"> </span>iris[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb15-4" title="4">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train_manual.html">automl_train_manual</a></span>(<span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat,</a>
<a class="sourceLine" id="cb15-5" title="5">                                <span class="dt">hpar =</span> <span class="kw">list</span>(<span class="dt">modexec =</span> <span class="st">'trainwpso'</span>,</a>
<a class="sourceLine" id="cb15-6" title="6">                                            <span class="dt">numiterations =</span> <span class="dv">30</span>,</a>
<a class="sourceLine" id="cb15-7" title="7">                                            <span class="dt">psopartpopsize =</span> <span class="dv">50</span>))</a></code></pre></div>
<pre><code>## (cost: mse)
## cost epoch10: 0.113576786377019 (cv cost: 0.0967069106128153) (LR:  0 ) 
## cost epoch20: 0.0595472259640828 (cv cost: 0.0831404427407914) (LR:  0 ) 
## cost epoch30: 0.0494578776185938 (cv cost: 0.0538888075333611) (LR:  0 ) 
##    dim X: [4,135]
##    dim W1: [10,4] (min|max: -9.74023257221123, 10)
##    dim bB1: [10,1] (min|max: -0.387606162285625, 0.1710556969915)
##    dim j1: [10,1] (min|max: 0.124551360015852, 5.3818348209072)
##    dim W2: [1,10] (min|max: -0.076169592619662, 0.0164342147682301)
##    dim bB2: [1,1] (min|max: 5.81920420695991, 5.81920420695991)
##    dim j2: [1,1] (min|max: 0.739758079637033, 0.739758079637033)
##    dim Y: [1,135]</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">res &lt;-<span class="st"> </span><span class="kw">cbind</span>(ymat, <span class="kw"><a href="../reference/automl_predict.html">automl_predict</a></span>(<span class="dt">model =</span> amlmodel, <span class="dt">X =</span> xmat))</a>
<a class="sourceLine" id="cb17-2" title="2"><span class="kw">colnames</span>(res) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'actual'</span>, <span class="st">'predict'</span>)</a>
<a class="sourceLine" id="cb17-3" title="3"><span class="kw">head</span>(res)</a></code></pre></div>
<pre><code>##      actual  predict
## [1,]    5.1 5.028114
## [2,]    4.9 4.673366
## [3,]    4.7 4.738188
## [4,]    4.6 4.821392
## [5,]    5.0 5.099064
## [6,]    5.4 5.277315</code></pre>
<p>Pretty good too, even better!<br></p>
<h4 id="fit-a-regression-model-manually-hard-way" class="subsectionHead">
<span class="titlemark">0.3.4 </span> <span id="x1-140000.3.4"></span>fit a regression model with custom cost (experimental way, Mix 2)
</h4>
<p>Same subject: predict Sepal.Length given other Iris parameters<br> Let’s try with Mean Absolute Percentage Error instead of Mean Square Error<br></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">data</span>(iris)</a>
<a class="sourceLine" id="cb19-2" title="2">xmat &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">cbind</span>(iris[,<span class="dv">2</span><span class="op">:</span><span class="dv">4</span>], <span class="kw">as.numeric</span>(iris<span class="op">$</span>Species)))</a>
<a class="sourceLine" id="cb19-3" title="3">ymat &lt;-<span class="st"> </span>iris[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb19-4" title="4">f &lt;-<span class="st"> 'J=abs((y-yhat)/y)'</span></a>
<a class="sourceLine" id="cb19-5" title="5">f &lt;-<span class="st"> </span><span class="kw">c</span>(f, <span class="st">'J=sum(J[!is.infinite(J)],na.rm=TRUE)'</span>)</a>
<a class="sourceLine" id="cb19-6" title="6">f &lt;-<span class="st"> </span><span class="kw">c</span>(f, <span class="st">'J=(J/length(y))'</span>)</a>
<a class="sourceLine" id="cb19-7" title="7">f &lt;-<span class="st"> </span><span class="kw">paste</span>(f, <span class="dt">collapse =</span> <span class="st">';'</span>)</a>
<a class="sourceLine" id="cb19-8" title="8">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train_manual.html">automl_train_manual</a></span>(<span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat,</a>
<a class="sourceLine" id="cb19-9" title="9">                                <span class="dt">hpar =</span> <span class="kw">list</span>(<span class="dt">modexec =</span> <span class="st">'trainwpso'</span>,</a>
<a class="sourceLine" id="cb19-10" title="10">                                            <span class="dt">numiterations =</span> <span class="dv">30</span>,</a>
<a class="sourceLine" id="cb19-11" title="11">                                            <span class="dt">psopartpopsize =</span> <span class="dv">50</span>,</a>
<a class="sourceLine" id="cb19-12" title="12">                                            <span class="dt">costcustformul =</span> f))</a></code></pre></div>
<pre><code>## (cost: custom)
## cost epoch10: 0.901580275333795 (cv cost: 1.15936129555304) (LR:  0 ) 
## cost epoch20: 0.890142834441629 (cv cost: 1.24167078564786) (LR:  0 ) 
## cost epoch30: 0.886088388448652 (cv cost: 1.22756121243449) (LR:  0 ) 
##    dim X: [4,135]
##    dim W1: [10,4] (min|max: -3.74973275656952, 2.18515186830331)
##    dim bB1: [10,1] (min|max: -0.0193015541942629, 0.0434980136379077)
##    dim j1: [10,1] (min|max: 0.0452374980846706, 1.31756069619528)
##    dim W2: [1,10] (min|max: -0.0137408031397005, 0.0448117596944683)
##    dim bB2: [1,1] (min|max: 0.0216923703335529, 0.0216923703335529)
##    dim j2: [1,1] (min|max: -6.12554946752224, -6.12554946752224)
##    dim Y: [1,135]</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">res &lt;-<span class="st"> </span><span class="kw">cbind</span>(ymat, <span class="kw"><a href="../reference/automl_predict.html">automl_predict</a></span>(<span class="dt">model =</span> amlmodel, <span class="dt">X =</span> xmat))</a>
<a class="sourceLine" id="cb21-2" title="2"><span class="kw">colnames</span>(res) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'actual'</span>, <span class="st">'predict'</span>)</a>
<a class="sourceLine" id="cb21-3" title="3"><span class="kw">head</span>(res)</a></code></pre></div>
<pre><code>##      actual  predict
## [1,]    5.1 4.693915
## [2,]    4.9 4.470968
## [3,]    4.7 4.482036
## [4,]    4.6 4.593667
## [5,]    5.0 4.738504
## [6,]    5.4 4.914144</code></pre>
<h4 id="fit-a-regression-model-manually-hard-way" class="subsectionHead">
<span class="titlemark">0.3.5 </span> <span id="x1-150000.3.5"></span>fit a classification model with softmax (Mix 2)
</h4>
<p>Subject: predict Species given other Iris parameters<br> Softmax is available with PSO, no derivative needed ;-)<br></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="kw">data</span>(iris)</a>
<a class="sourceLine" id="cb23-2" title="2">xmat =<span class="st"> </span>iris[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</a>
<a class="sourceLine" id="cb23-3" title="3">lab2pred &lt;-<span class="st"> </span><span class="kw">levels</span>(iris<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb23-4" title="4">lghlab &lt;-<span class="st"> </span><span class="kw">length</span>(lab2pred)</a>
<a class="sourceLine" id="cb23-5" title="5">iris<span class="op">$</span>Species &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(iris<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb23-6" title="6">ymat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">1</span>, <span class="dt">to =</span> lghlab, <span class="dt">by =</span> <span class="dv">1</span>), <span class="kw">nrow</span>(xmat), lghlab, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb23-7" title="7">ymat &lt;-<span class="st"> </span>(ymat <span class="op">==</span><span class="st"> </span><span class="kw">as.numeric</span>(iris<span class="op">$</span>Species)) <span class="op">+</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb23-8" title="8">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train_manual.html">automl_train_manual</a></span>(<span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat,</a>
<a class="sourceLine" id="cb23-9" title="9">                                <span class="dt">hpar =</span> <span class="kw">list</span>(<span class="dt">modexec =</span> <span class="st">'trainwpso'</span>,</a>
<a class="sourceLine" id="cb23-10" title="10">                                <span class="dt">layersshape =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb23-11" title="11">                                <span class="dt">layersacttype =</span> <span class="kw">c</span>(<span class="st">'relu'</span>, <span class="st">'softmax'</span>),</a>
<a class="sourceLine" id="cb23-12" title="12">                                <span class="dt">layersdropoprob =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb23-13" title="13">                                <span class="dt">numiterations =</span> <span class="dv">50</span>,</a>
<a class="sourceLine" id="cb23-14" title="14">                                <span class="dt">psopartpopsize =</span> <span class="dv">50</span>))</a></code></pre></div>
<pre><code>## (cost: crossentropy)
## cost epoch10: 0.373706545886467 (cv cost: 0.36117608867856) (LR:  0 ) 
## cost epoch20: 0.267034060152876 (cv cost: 0.163635821437066) (LR:  0 ) 
## cost epoch30: 0.212054571476337 (cv cost: 0.112664100290429) (LR:  0 ) 
## cost epoch40: 0.154158717402463 (cv cost: 0.102895917099299) (LR:  0 ) 
## cost epoch50: 0.141037927317585 (cv cost: 0.0864623836595045) (LR:  0 ) 
##    dim X: [4,135]
##    dim W1: [10,4] (min|max: -6.06580422377101, 3.99787561794882)
##    dim bB1: [10,1] (min|max: -0.0383581046802848, 0.182545610199413)
##    dim j1: [10,1] (min|max: 0.233318516360136, 2.76049296574839)
##    dim W2: [3,10] (min|max: -0.0518744226871539, 0.0803609160652066)
##    dim bB2: [3,1] (min|max: -0.0165862349385389, 0.0974829458643821)
##    dim j2: [3,1] (min|max: 1.35026790529631, 4.95476076574517)
##    dim Y: [3,135]</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">res &lt;-<span class="st"> </span><span class="kw">cbind</span>(ymat, <span class="kw"><a href="../reference/automl_predict.html">automl_predict</a></span>(<span class="dt">model =</span> amlmodel, <span class="dt">X =</span> xmat))</a>
<a class="sourceLine" id="cb25-2" title="2"><span class="kw">colnames</span>(res) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">paste</span>(<span class="st">'act'</span>,lab2pred, <span class="dt">sep =</span> <span class="st">'_'</span>),</a>
<a class="sourceLine" id="cb25-3" title="3"><span class="kw">paste</span>(<span class="st">'pred'</span>,lab2pred, <span class="dt">sep =</span> <span class="st">'_'</span>))</a>
<a class="sourceLine" id="cb25-4" title="4"><span class="kw">head</span>(res)</a></code></pre></div>
<pre><code>##   act_setosa act_versicolor act_virginica pred_setosa pred_versicolor
## 1          1              0             0   0.9863481     0.003268881
## 2          1              0             0   0.9897295     0.003387193
## 3          1              0             0   0.9856347     0.002025946
## 4          1              0             0   0.9819881     0.004638452
## 5          1              0             0   0.9827623     0.003115452
## 6          1              0             0   0.9329747     0.031624836
##   pred_virginica
## 1    0.010383018
## 2    0.006883349
## 3    0.012339349
## 4    0.013373451
## 5    0.014122277
## 6    0.035400439</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1"><span class="kw">tail</span>(res)</a></code></pre></div>
<pre><code>##     act_setosa act_versicolor act_virginica pred_setosa pred_versicolor
## 145          0              0             1  0.02549091    2.877957e-05
## 146          0              0             1  0.08146753    2.005664e-03
## 147          0              0             1  0.05465750    1.979652e-02
## 148          0              0             1  0.06040415    1.974869e-02
## 149          0              0             1  0.02318048    4.133826e-04
## 150          0              0             1  0.03696852    5.230936e-02
##     pred_virginica
## 145      0.9744803
## 146      0.9165268
## 147      0.9255460
## 148      0.9198472
## 149      0.9764061
## 150      0.9107221</code></pre>
<h4 id="fit-a-regression-model-manually-hard-way" class="subsectionHead">
<span class="titlemark">0.3.6 </span> <span id="x1-160000.3.6"></span>change the model parameters (shape …)
</h4>
<p>Same subject: predict Species given other Iris parameters<br> 1st example: with gradient descent and 2 hidden layers containing 10 nodes, with various activation functions for hidden layers<br></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1"><span class="kw">data</span>(iris)</a>
<a class="sourceLine" id="cb29-2" title="2">xmat =<span class="st"> </span>iris[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</a>
<a class="sourceLine" id="cb29-3" title="3">lab2pred &lt;-<span class="st"> </span><span class="kw">levels</span>(iris<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb29-4" title="4">lghlab &lt;-<span class="st"> </span><span class="kw">length</span>(lab2pred)</a>
<a class="sourceLine" id="cb29-5" title="5">iris<span class="op">$</span>Species &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(iris<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb29-6" title="6">ymat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">1</span>, <span class="dt">to =</span> lghlab, <span class="dt">by =</span> <span class="dv">1</span>), <span class="kw">nrow</span>(xmat), lghlab, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb29-7" title="7">ymat &lt;-<span class="st"> </span>(ymat <span class="op">==</span><span class="st"> </span><span class="kw">as.numeric</span>(iris<span class="op">$</span>Species)) <span class="op">+</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb29-8" title="8">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train_manual.html">automl_train_manual</a></span>(</a>
<a class="sourceLine" id="cb29-9" title="9">                <span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat,</a>
<a class="sourceLine" id="cb29-10" title="10">                <span class="dt">hpar =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb29-11" title="11">                    <span class="dt">layersshape =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb29-12" title="12">                    <span class="dt">layersacttype =</span> <span class="kw">c</span>(<span class="st">'tanh'</span>, <span class="st">'relu'</span>, <span class="st">''</span>),</a>
<a class="sourceLine" id="cb29-13" title="13">                    <span class="dt">layersdropoprob =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)))</a></code></pre></div>
<pre><code>## (cost: crossentropy)
## cost epoch10: 2.41325242052537 (cv cost: 0.951806491052378) (LR:  0.001 ) 
## cost epoch20: 2.39981582102664 (cv cost: 0.824359586244002) (LR:  0.001 ) 
## cost epoch30: 2.38675064044667 (cv cost: 0.964281122916916) (LR:  0.001 ) 
## cost epoch40: 2.37511219594812 (cv cost: 0.984804476392134) (LR:  0.001 ) 
## cost epoch50: 2.36537225332899 (cv cost: 1.00906865173689) (LR:  0.001 ) 
##    dim X: [4,135]
##    dim W1: [10,4] (min|max: -1.17844190602841, 1.17623904342124)
##    dim bB1: [10,1] (min|max: -0.171280904463528, 0.170073959995729)
##    dim j1: [10,1] (min|max: 0.834989059174756, 1.04591303447967)
##    dim W2: [10,10] (min|max: -0.864498450147197, 1.17157236499935)
##    dim bB2: [10,1] (min|max: -0.166479516706595, -0.0175789096131513)
##    dim j2: [10,1] (min|max: 0.915919628756264, 1.05962744467235)
##    dim W3: [3,10] (min|max: -0.0443294023087402, 0.0663865843224797)
##    dim bB3: [3,1] (min|max: -0.084494659874969, -0.0474264925511486)
##    dim j3: [3,1] (min|max: 0.880875803781447, 0.947129830590927)
##    dim Y: [3,135]</code></pre>
<p>nb: last activation type may be left to blank (it will be set automatically)<br><br> 2nd example: with gradient descent and no hidden layer (logistic regression)<br></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1"><span class="kw">data</span>(iris)</a>
<a class="sourceLine" id="cb31-2" title="2">xmat =<span class="st"> </span>iris[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</a>
<a class="sourceLine" id="cb31-3" title="3">lab2pred &lt;-<span class="st"> </span><span class="kw">levels</span>(iris<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb31-4" title="4">lghlab &lt;-<span class="st"> </span><span class="kw">length</span>(lab2pred)</a>
<a class="sourceLine" id="cb31-5" title="5">iris<span class="op">$</span>Species &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(iris<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb31-6" title="6">ymat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">1</span>, <span class="dt">to =</span> lghlab, <span class="dt">by =</span> <span class="dv">1</span>), <span class="kw">nrow</span>(xmat), lghlab, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb31-7" title="7">ymat &lt;-<span class="st"> </span>(ymat <span class="op">==</span><span class="st"> </span><span class="kw">as.numeric</span>(iris<span class="op">$</span>Species)) <span class="op">+</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb31-8" title="8">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train_manual.html">automl_train_manual</a></span>(<span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat,</a>
<a class="sourceLine" id="cb31-9" title="9">                <span class="dt">hpar =</span> <span class="kw">list</span>(<span class="dt">layersshape =</span> <span class="kw">c</span>(<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb31-10" title="10">                    <span class="dt">layersacttype =</span> <span class="kw">c</span>(<span class="st">'sigmoid'</span>),</a>
<a class="sourceLine" id="cb31-11" title="11">                    <span class="dt">layersdropoprob =</span> <span class="kw">c</span>(<span class="dv">0</span>)))</a></code></pre></div>
<pre><code>## (cost: crossentropy)
## cost epoch10: 2.41256625698174 (cv cost: 1.52787772773656) (LR:  0.001 ) 
## cost epoch20: 2.39487960709668 (cv cost: 1.30539484912328) (LR:  0.001 ) 
## cost epoch30: 2.37790838174604 (cv cost: 0.914874371089548) (LR:  0.001 ) 
## cost epoch40: 2.36237291354489 (cv cost: 1.23368286521283) (LR:  0.001 ) 
## cost epoch50: 2.34978864866666 (cv cost: 1.26105975399258) (LR:  0.001 ) 
##    dim X: [4,135]
##    dim W1: [3,4] (min|max: -0.0824233319087832, 0.0665219165277063)
##    dim bB1: [3,1] (min|max: -0.0853265142410669, -0.0504193608620526)
##    dim j1: [3,1] (min|max: 0.877190207011175, 0.912854186557978)
##    dim Y: [3,135]</code></pre>
<p>We saved the model to continue training later (see below in next section)</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1">amlmodelsaved &lt;-<span class="st"> </span>amlmodel</a></code></pre></div>
<h4 id="fit-a-regression-model-manually-hard-way" class="subsectionHead">
<span class="titlemark">0.3.7 </span> <span id="x1-170000.3.7"></span>continue training on saved model (fine tuning …)
</h4>
<p>Subject: continue training on saved model (model saved above in last section)<br></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train_manual.html">automl_train_manual</a></span>(<span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat,</a>
<a class="sourceLine" id="cb34-2" title="2">                <span class="dt">hpar =</span> <span class="kw">list</span>(<span class="dt">numiterations =</span> <span class="dv">100</span>,</a>
<a class="sourceLine" id="cb34-3" title="3">                    <span class="dt">psopartpopsize =</span> <span class="dv">50</span>),</a>
<a class="sourceLine" id="cb34-4" title="4">                <span class="dt">mdlref =</span> amlmodelsaved)</a></code></pre></div>
<pre><code>## (cost: crossentropy)
## cost epoch10: 2.33948479711291 (cv cost: 1.35721982997238) (LR:  0.001 ) 
## cost epoch20: 2.32669285753264 (cv cost: 1.30152708067868) (LR:  0.001 ) 
## cost epoch30: 2.31504805288479 (cv cost: 1.29552449383989) (LR:  0.001 ) 
## cost epoch40: 2.30430035748777 (cv cost: 1.29397405747141) (LR:  0.001 ) 
## cost epoch50: 2.29430374216071 (cv cost: 1.29240693651625) (LR:  0.001 ) 
## cost epoch60: 2.28495815493859 (cv cost: 1.29246202979512) (LR:  0.001 ) 
## cost epoch70: 2.27608005019126 (cv cost: 1.29620090185108) (LR:  0.001 ) 
## cost epoch80: 2.26753980962059 (cv cost: 1.30192962431549) (LR:  0.001 ) 
## cost epoch90: 2.25934270485252 (cv cost: 1.30591289162664) (LR:  0.001 ) 
## cost epoch100: 2.25229290115905 (cv cost: 1.30730635529278) (LR:  0.001 ) 
##    dim X: [4,135]
##    dim W1: [3,4] (min|max: -0.0584244836620892, 0.0979357668398827)
##    dim bB1: [3,1] (min|max: -0.235339245685138, -0.147348457818883)
##    dim j1: [3,1] (min|max: 0.675771007836825, 0.773425314642678)
##    dim Y: [3,135]</code></pre>
<p>We can see the error continuing to decrease from last training<br> The training continued with the same parameters, but notice that we were able to change the number of iterations<br></p>
<h4 id="fit-a-regression-model-manually-hard-way" class="subsectionHead">
<span class="titlemark">0.3.8 </span> <span id="x1-180000.3.8"></span>use the 2 steps automatic approach
</h4>
<p>Same subject: predict Species given other Iris parameters<br> Let’s try the automatic approach in 2 steps with the same Logistic Regression architecture;<br> 1st step goal is performance, overfitting<br> 2nd step is robustness, regularization<br></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1"><span class="kw">data</span>(iris)</a>
<a class="sourceLine" id="cb36-2" title="2">xmat =<span class="st"> </span>iris[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</a>
<a class="sourceLine" id="cb36-3" title="3">lab2pred &lt;-<span class="st"> </span><span class="kw">levels</span>(iris<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb36-4" title="4">lghlab &lt;-<span class="st"> </span><span class="kw">length</span>(lab2pred)</a>
<a class="sourceLine" id="cb36-5" title="5">iris<span class="op">$</span>Species &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(iris<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb36-6" title="6">ymat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">1</span>, <span class="dt">to =</span> lghlab, <span class="dt">by =</span> <span class="dv">1</span>), <span class="kw">nrow</span>(xmat), lghlab, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb36-7" title="7">ymat &lt;-<span class="st"> </span>(ymat <span class="op">==</span><span class="st"> </span><span class="kw">as.numeric</span>(iris<span class="op">$</span>Species)) <span class="op">+</span><span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb36-8" title="8">amlmodel &lt;-<span class="st"> </span><span class="kw"><a href="../reference/automl_train.html">automl_train</a></span>(<span class="dt">Xref =</span> xmat, <span class="dt">Yref =</span> ymat,</a>
<a class="sourceLine" id="cb36-9" title="9">                <span class="dt">hpar =</span> <span class="kw">list</span>(<span class="dt">layersshape =</span> <span class="kw">c</span>(<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb36-10" title="10">                   <span class="dt">layersacttype =</span> <span class="kw">c</span>(<span class="st">'sigmoid'</span>),</a>
<a class="sourceLine" id="cb36-11" title="11">                   <span class="dt">layersdropoprob =</span> <span class="kw">c</span>(<span class="dv">0</span>)),</a>
<a class="sourceLine" id="cb36-12" title="12">                <span class="dt">autopar =</span> <span class="kw">list</span>(<span class="dt">auto_runtype =</span> <span class="st">'2steps'</span>))</a></code></pre></div>
<pre><code>## STEP: 1 (overfitting)
## (cost: crossentropy)
## iteration 1 particle 1 weighted err: 2.42056 BEST MODEL KEPT
## iteration 1 particle 2 weighted err: 2.40494 BEST MODEL KEPT
## iteration 1 particle 3 weighted err: 2.41726
## iteration 1 particle 4 weighted err: 2.42334
## iteration 1 particle 5 weighted err: 2.4091
## iteration 1 particle 6 weighted err: 2.41962
## iteration 1 particle 7 weighted err: 2.40137 BEST MODEL KEPT
## iteration 1 particle 8 weighted err: 2.34594 BEST MODEL KEPT
## iteration 2 particle 1 weighted err: 2.41459
## iteration 2 particle 2 weighted err: 2.39745
## iteration 2 particle 3 weighted err: 2.346
## iteration 2 particle 4 weighted err: 2.41773
## iteration 2 particle 5 weighted err: 2.35627
## iteration 2 particle 6 weighted err: 2.40502
## iteration 2 particle 7 weighted err: 2.38905
## iteration 2 particle 8 weighted err: 2.34594
## iteration 3 particle 1 weighted err: 2.39013
## iteration 3 particle 2 weighted err: 2.36849
## iteration 3 particle 3 weighted err: 2.23385 BEST MODEL KEPT
## iteration 3 particle 4 weighted err: 2.40762
## iteration 3 particle 5 weighted err: 2.33986
## iteration 3 particle 6 weighted err: 2.39917
## iteration 3 particle 7 weighted err: 2.38197
## iteration 3 particle 8 weighted err: 2.34594
## STEP: 2 (regularization)
## (cost: crossentropy)
## iteration 1 particle 1 weighted err: 2.70508 (train: 2.24474 cvalid: 1.09389 ) BEST MODEL KEPT
## iteration 1 particle 2 weighted err: 2.71015 (train: 2.2452 cvalid: 1.08283 )
## iteration 1 particle 3 weighted err: 2.2944 (train: 2.23677 cvalid: 2.0927 ) BEST MODEL KEPT
## iteration 1 particle 4 weighted err: 2.6911 (train: 2.23902 cvalid: 1.1088 )
## iteration 1 particle 5 weighted err: 2.69633 (train: 2.24061 cvalid: 1.10131 )
## iteration 1 particle 6 weighted err: 2.68252 (train: 2.24303 cvalid: 1.14432 )
## iteration 1 particle 7 weighted err: 2.75194 (train: 2.24576 cvalid: 0.98029 )
## iteration 1 particle 8 weighted err: 4.64173 (train: 2.23456 cvalid: 3.73904 )
## iteration 2 particle 1 weighted err: 2.70508 (train: 2.24474 cvalid: 1.09389 )
## iteration 2 particle 2 weighted err: 2.71015 (train: 2.2452 cvalid: 1.08283 )
## iteration 2 particle 3 weighted err: 2.24647 (train: 2.23637 cvalid: 2.21111 ) BEST MODEL KEPT
## iteration 2 particle 4 weighted err: 2.68907 (train: 2.23757 cvalid: 1.1088 )
## iteration 2 particle 5 weighted err: 2.58933 (train: 2.24078 cvalid: 1.36939 )
## iteration 2 particle 6 weighted err: 2.65867 (train: 2.24364 cvalid: 1.20606 )
## iteration 2 particle 7 weighted err: 2.69105 (train: 2.24379 cvalid: 1.12563 )
## iteration 2 particle 8 weighted err: 2.68861 (train: 2.24369 cvalid: 1.13141 )
## iteration 3 particle 1 weighted err: 2.69592 (train: 2.24417 cvalid: 1.11481 )
## iteration 3 particle 2 weighted err: 2.71015 (train: 2.2452 cvalid: 1.08283 )
## iteration 3 particle 3 weighted err: 2.24647 (train: 2.23637 cvalid: 2.21111 )
## iteration 3 particle 4 weighted err: 2.68907 (train: 2.23757 cvalid: 1.1088 )
## iteration 3 particle 5 weighted err: 2.58933 (train: 2.24078 cvalid: 1.36939 )
## iteration 3 particle 6 weighted err: 2.65867 (train: 2.24364 cvalid: 1.20606 )
## iteration 3 particle 7 weighted err: 2.69105 (train: 2.24379 cvalid: 1.12563 )
## iteration 3 particle 8 weighted err: 2.68861 (train: 2.24369 cvalid: 1.13141 )</code></pre>
<p>Compared to the last runs (in previous sections above), difference between train and cross validation errors is much more tenuous<br> Automatically :-)<br></p>
<h3 id="todo-list" class="sectionHead">
<span class="titlemark">0.4 </span> <span id="x1-190000.4"></span>ToDo List
</h3>
<p>
</p>
<ul>
<li>transfert learning from existing frameworks<br>
</li>
<li>CNN<br>
</li>
<li>RNN<br><br> -&gt; join the team !<br><a href="https://aboulaboul.github.io/automl" class="uri">https://aboulaboul.github.io/automl</a> <br><a href="https://github.com/aboulaboul/automl" class="uri">https://github.com/aboulaboul/automl</a>


</li>
</ul>
</div>
</div>
</div>
</body>
</html><html>
<div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>
<footer><div class="copyright">
  <p>Developed by Alex Boulangé.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</html>
